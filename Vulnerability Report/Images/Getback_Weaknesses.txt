let
    // ===== 1. Point to the Getback folder =====
    FolderPath = 
        "C:\Users\PhillipsJacob\OneDrive - First Carolina Bank\Documents\Vulnerability Exports\DefenderExports\Getback",

    AllFiles  = Folder.Files(FolderPath),

    // Keep only .xlsx that look like the weaknesses export
    XlsxFiles =
        Table.SelectRows(
            AllFiles,
            each Text.Lower([Extension]) = ".xlsx"
                 and Text.Contains(Text.Lower([Name]), "tvm-vulnerabilities")
        ),

    // ===== 2. Take the newest file =====
    Latest =
        Table.FirstN(
            Table.Sort(XlsxFiles, {{"Date modified", Order.Descending}}),
            1
        ),

    FullPath = Latest{0}[Folder Path] & Latest{0}[Name],

    // ===== 3. Read Excel and get the first sheet/table =====
    Source = Excel.Workbook(File.Contents(FullPath), null, true),

    // If your data is a sheet, this keeps the first sheet.
    // If you use a table instead, change [Kind] = "Sheet" to "Table"
    SheetsOnly = Table.SelectRows(Source, each [Kind] = "Sheet"),
    FirstSheet = SheetsOnly{0}[Data],

    #"Promoted Headers" =
        Table.PromoteHeaders(FirstSheet, [PromoteAllScalars = true]),

    // ===== 4. Basic types for the columns we care about =====
    Typed =
        Table.TransformColumnTypes(
            #"Promoted Headers",
            {
                {"Age (days)", Int64.Type},
                {"Has Known Threats", type text}
            },
            "en-US"
        ),

    // ===== 5. Normalise Has Known Threats -> logical =====
    ThreatsFixed =
        Table.TransformColumns(
            Typed,
            {
                {
                    "Has Known Threats",
                    each if _ = "True" or _ = "true" then true
                         else if _ = "False" or _ = "false" then false
                         else _,
                    type logical
                }
            }
        ),

    // Keep only rows where Has Known Threats = true
    Filtered =
        Table.SelectRows(ThreatsFixed, each [Has Known Threats] = true),

    // ===== 6. Add Age Category buckets from Age (days) =====
    WithAgeCategory =
        Table.AddColumn(
            Filtered,
            "Age Category",
            each
                let a = [#"Age (days)"]
                in  if a >= 365 then "1+ years"
                    else if a >= 180 then "180-365 days"
                    else if a >= 90 then "90-180 days"
                    else if a >= 30 then "30-90 days"
                    else "1-30 days",
            type text
        ),
    #"Changed Type" = Table.TransformColumnTypes(WithAgeCategory,{{"Exposed Machines", Int64.Type}})
in
    #"Changed Type"